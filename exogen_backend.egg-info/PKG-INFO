Metadata-Version: 2.4
Name: exogen-backend
Version: 0.1.0
Summary: Exogen backend server
Requires-Python: >=3.11
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: accelerate==1.9.0
Requires-Dist: aiohappyeyeballs==2.6.1
Requires-Dist: aiohttp==3.12.14
Requires-Dist: aiosignal==1.4.0
Requires-Dist: alabaster==1.0.0
Requires-Dist: alembic==1.16.4
Requires-Dist: annotated-types==0.7.0
Requires-Dist: anyio==4.10.0
Requires-Dist: asttokens==3.0.0
Requires-Dist: attr==0.3.2
Requires-Dist: attrs==25.3.0
Requires-Dist: babel==2.17.0
Requires-Dist: basicsr
Requires-Dist: bidict==0.23.1
Requires-Dist: brotli==1.2.0
Requires-Dist: brotlicffi==1.1.0.0
Requires-Dist: certifi==2025.8.3
Requires-Dist: cffi==1.17.1
Requires-Dist: chardet==5.2.0
Requires-Dist: charset-normalizer==3.4.3
Requires-Dist: click==8.2.1
Requires-Dist: colorlog==6.9.0
Requires-Dist: comm==0.2.3
Requires-Dist: configparser==7.2.0
Requires-Dist: coverage==7.10.4
Requires-Dist: cryptography==45.0.5
Requires-Dist: decorator==5.2.1
Requires-Dist: diffusers==0.35.2
Requires-Dist: docopt==0.6.2
Requires-Dist: docutils==0.21.2
Requires-Dist: executing==2.2.0
Requires-Dist: fanstatic==1.5
Requires-Dist: fastapi==0.116.1
Requires-Dist: filelock==3.18.0
Requires-Dist: frozenlist==1.7.0
Requires-Dist: fsspec==2025.7.0
Requires-Dist: greenlet==3.2.4
Requires-Dist: h11==0.16.0
Requires-Dist: h2==4.2.0
Requires-Dist: hf-xet==1.2.0
Requires-Dist: hpack==4.1.0
Requires-Dist: htmlparser==0.0.2
Requires-Dist: httpcore==1.0.9
Requires-Dist: httpx==0.27.2
Requires-Dist: huggingface-hub==0.34.0
Requires-Dist: hyperframe==6.1.0
Requires-Dist: idna==3.10
Requires-Dist: imagesize==1.4.1
Requires-Dist: importlib-metadata==8.7.0
Requires-Dist: iniconfig==2.1.0
Requires-Dist: ipython==9.4.0
Requires-Dist: ipython-pygments-lexers==1.1.1
Requires-Dist: ipywidgets==8.1.7
Requires-Dist: jaraco-classes==3.4.0
Requires-Dist: jaraco-context==6.0.1
Requires-Dist: jaraco-functools==4.3.0
Requires-Dist: jedi==0.19.2
Requires-Dist: jeepney==0.9.0
Requires-Dist: jinja2==3.1.6
Requires-Dist: js==1.0
Requires-Dist: jupyterlab-widgets==3.0.15
Requires-Dist: keyring==25.6.0
Requires-Dist: legacy-cgi==2.6.3
Requires-Dist: mako==1.3.10
Requires-Dist: markupsafe==3.0.2
Requires-Dist: matplotlib-inline==0.1.7
Requires-Dist: more-itertools==10.7.0
Requires-Dist: mpmath==1.3.0
Requires-Dist: multidict==6.6.4
Requires-Dist: networkx==3.5
Requires-Dist: numpy==2.3.2
Requires-Dist: packaging==25.0
Requires-Dist: parso==0.8.4
Requires-Dist: peft>=0.18.0
Requires-Dist: pexpect==4.9.0
Requires-Dist: pillow==11.3.0
Requires-Dist: pip==25.3
Requires-Dist: pipreqs==0.4.13
Requires-Dist: pluggy==1.6.0
Requires-Dist: prompt-toolkit==3.0.51
Requires-Dist: propcache==0.3.2
Requires-Dist: protobuf>=6.33.1
Requires-Dist: psutil==7.0.0
Requires-Dist: ptyprocess==0.7.0
Requires-Dist: pure-eval==0.2.3
Requires-Dist: pycparser==2.22
Requires-Dist: pydantic==2.11.7
Requires-Dist: pydantic-core==2.33.2
Requires-Dist: pydash>=8.0.5
Requires-Dist: pygments==2.19.2
Requires-Dist: pyopenssl==25.1.0
Requires-Dist: pypdl>=1.5.7
Requires-Dist: pytest==8.3.3
Requires-Dist: pytest-asyncio==0.24.0
Requires-Dist: pytest-cov==5.0.0
Requires-Dist: python-engineio==4.12.2
Requires-Dist: python-socketio==5.14.0
Requires-Dist: pyyaml==6.0.2
Requires-Dist: realesrgan>=0.3.0
Requires-Dist: redis==6.2.0
Requires-Dist: regex==2025.7.34
Requires-Dist: requests==2.32.5
Requires-Dist: roman-numerals-py==3.1.0
Requires-Dist: safetensors==0.6.2
Requires-Dist: scipy>=1.16.3
Requires-Dist: secretstorage==3.3.3
Requires-Dist: setuptools==80.9.0
Requires-Dist: simple-websocket==1.1.0
Requires-Dist: simplejson==3.20.1
Requires-Dist: sniffio==1.3.1
Requires-Dist: snowballstemmer==3.0.1
Requires-Dist: sphinx==8.2.3
Requires-Dist: sphinxcontrib-applehelp==2.0.0
Requires-Dist: sphinxcontrib-devhelp==2.0.0
Requires-Dist: sphinxcontrib-htmlhelp==2.1.0
Requires-Dist: sphinxcontrib-jsmath==1.0.1
Requires-Dist: sphinxcontrib-qthelp==2.0.0
Requires-Dist: sphinxcontrib-serializinghtml==2.0.0
Requires-Dist: sqlalchemy==2.0.41
Requires-Dist: stack-data==0.6.3
Requires-Dist: starlette==0.47.2
Requires-Dist: sympy==1.13.1
Requires-Dist: tenacity==9.1.2
Requires-Dist: thread==2.0.5
Requires-Dist: tokenizers==0.22.1
Requires-Dist: torch==2.6.0+cu124
Requires-Dist: torchsde>=0.2.6
Requires-Dist: torchvision==0.21.0
Requires-Dist: tqdm==4.67.1
Requires-Dist: traitlets==5.14.3
Requires-Dist: trampoline>=0.1.2
Requires-Dist: transformers==4.57.1
Requires-Dist: triton==3.2.0; sys_platform == "linux"
Requires-Dist: ty>=0.0.1a28
Requires-Dist: typing-extensions==4.15.0
Requires-Dist: typing-inspection==0.4.1
Requires-Dist: urllib3==2.6.0
Requires-Dist: urllib3-secure-extra==0.1.0
Requires-Dist: uvicorn==0.35.0
Requires-Dist: wcwidth==0.2.13
Requires-Dist: webob==1.8.9
Requires-Dist: widgetsnbextension==4.0.14
Requires-Dist: wsproto==1.2.0
Requires-Dist: yarg==0.1.10
Requires-Dist: yarl==1.20.1
Requires-Dist: zipp==3.23.0
Requires-Dist: zstandard==0.23.0
Dynamic: license-file

# Exogen Backend

A FastAPI-based backend server for local AI image generation, supporting Stable Diffusion models (SD 1.5, SDXL, SD3), LoRA adapters, AI upscaling, and real-time generation updates via WebSocket.

## Features

### Image Generation
- **Text-to-Image**: Generate images with customizable parameters (steps, CFG scale, dimensions, seed)
- **Image-to-Image**: Transform existing images with strength and resize controls
- **High-Resolution Fix**: Two-pass generation with upscale and refinement
- **18 Samplers**: Euler A, DPM++ 2M Karras, UniPC, LCM, and more
- **LoRA Support**: Apply 1-5 LoRAs per generation with individual weights and CLIP skip

### Upscaling
- **AI Upscalers** (Real-ESRGAN): x2plus, x4plus, x4plus_anime
- **Traditional Upscalers**: Lanczos, Bicubic, Bilinear, Nearest

### Model Management
- **Download Models**: From Hugging Face Hub with progress tracking
- **Smart Filtering**: Only downloads required model components
- **Load/Unload**: With cancellation support and state tracking
- **Recommendations**: Hardware-based model suggestions
- **LoRA Management**: Upload, list, and manage LoRA files

### Safety & Quality
- **NSFW Detection**: Works with SD 1.5, SDXL, and SD3 models
- **Configurable**: Toggle safety checker via API

### Hardware & Performance
- **Multi-Platform**: CUDA (NVIDIA), MPS (Apple Silicon), CPU fallback
- **Multi-GPU**: Device selection for systems with multiple GPUs
- **Memory Management**: Configurable GPU/RAM scale factors with OOM prevention
- **Real-time Monitoring**: GPU/CPU usage and memory tracking

### Additional Features
- **Style System**: 85+ style categories with prompt templates
- **Generation History**: Track and retrieve past generations
- **Real-time Updates**: WebSocket events for progress, phases, and previews
- **Configuration API**: Manage upscalers, safety settings, memory, and device selection
- **SQLite Database**: Persistent storage with Alembic migrations

## Requirements

- Python 3.11+
- CUDA-compatible GPU recommended (NVIDIA) or Apple Silicon (MPS)
- 8GB+ RAM (16GB+ recommended for larger models)
- 50GB+ disk space for models (some models can exceed 50GB)

## Installation

1. **Clone the repository**

   ```bash
   git clone https://github.com/andyngdz/exogen_backend.git
   cd exogen_backend
   ```

2. **Install uv** (Python package manager)

   ```bash
   # Linux/macOS
   curl -LsSf https://astral.sh/uv/install.sh | sh

   # Windows
   powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
   ```

   More installation methods: [uv documentation](https://docs.astral.sh/uv/getting-started/installation/)

3. **Install dependencies**

   ```bash
   uv sync
   ```

4. **Initialize database**

   ```bash
   uv run alembic upgrade head
   ```

## Running the Server

**Development mode** (with auto-reload):

```bash
uv run uvicorn main:app --reload
```

**Production mode**:

```bash
uv run uvicorn main:app --host 0.0.0.0 --port 8000
```

The API will be available at `http://localhost:8000` with interactive docs at `http://localhost:8000/docs`.

## Development

### Running tests

```bash
uv run pytest                    # All tests
uv run pytest tests/path/to/test.py  # Single file
uv run pytest -q --cov=app       # With coverage
```

### Code quality

```bash
uv run ruff format               # Format code
uv run ruff check --fix          # Lint and auto-fix
uv run ty check                  # Type checking
```

Pre-commit hooks run these automatically on commit.

### Database migrations

```bash
uv run alembic revision --autogenerate -m "description"  # Create migration
uv run alembic upgrade head                              # Apply migrations
uv run alembic downgrade -1                              # Rollback
```

## Configuration

Configuration is managed through `config.py` and the `/config` API endpoint:

| Setting | Description |
|---------|-------------|
| `CACHE_FOLDER` | Model cache directory (default: `./.cache`) |
| `GENERATED_IMAGES_FOLDER` | Output directory for generated images |
| `STATIC_FOLDER` | Static files directory |

Runtime settings (via `/config` API):
- **Safety Check**: Toggle NSFW detection
- **GPU Scale Factor**: Memory allocation for GPU (0.1-1.0)
- **RAM Scale Factor**: Memory allocation for RAM (0.1-1.0)
- **Device Index**: GPU selection for multi-GPU systems

## Contributing

1. Follow the coding style in `ruff.toml` (tabs, single quotes, 120 char lines)
2. Use conventional commits (`feat:`, `fix:`, `refactor:`, etc.)
3. Write tests for new features
4. Ensure tests pass and code is linted before submitting PRs

See `docs/` for detailed development guidelines.

## Feedback & Issues

We welcome contributions and feedback! If you encounter any issues or have suggestions:

- **Report bugs**: [Open an issue](https://github.com/andyngdz/exogen_backend/issues)
- **Feature requests**: [Start a discussion](https://github.com/andyngdz/exogen_backend/discussions)
- **Contribute**: Fork the repo and submit a pull request

## License

MIT License - see [LICENSE](LICENSE) for details.

## Acknowledgments

- [FastAPI](https://fastapi.tiangolo.com/) - Web framework
- [Hugging Face Diffusers](https://huggingface.co/docs/diffusers) - Diffusion models
- [Real-ESRGAN](https://github.com/xinntao/Real-ESRGAN) - AI upscaling
- [python-socketio](https://python-socketio.readthedocs.io/) - Real-time communication
